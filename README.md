# KHMS-TRADER  
### Next-Open 기반 한국 주식 자동매매 시스템

**License**: MIT  
**Language**: Python  
**Broker**: Korea Investment (KIS) Virtual  
**Status**: Research & Trading System  

---

## 🔍 KHMS-TRADER

**KHMS-TRADER**는 한국 주식시장(KOSDAQ 중심)을 대상으로  
**다음 거래일 시가 기준(Next-Open)** 전략을 연구·운영하기 위한  
모듈형 자동매매 및 시뮬레이션 프로젝트입니다.

본 프로젝트는 단기 수익률보다  
**사고 없는 자동매매 구조 설계와 운영 안정성**을 최우선 목표로 합니다.

전략 생성, 주문 실행, 계좌 상태 조회, 대시보드를 명확히 분리하여  
실험과 실제 운영을 안전하게 구분할 수 있도록 설계되었습니다.

---

## ✨ 프로젝트 특징

- Next-Open 전략 기반 (전일 장 마감 → 다음날 시가 실행)
- 한국투자증권(KIS) 모의투자(Virtual) API 연동
- Plan 생성 / 주문 실행 완전 분리 구조
- 보유하지 않은 종목에 대한 매도 자동 차단
- Paper / Virtual / Real 확장 가능한 브로커 구조
- Streamlit 기반 실시간 대시보드
- 텔레그램 알림 연동 (선택)
- 실험과 운영 상태 혼선 방지 설계

---

## 📁 시스템 구성

### Core Engine
- 전략 신호 생성
- Next-Open plan 생성
- 주문 실행 및 체결 처리
- 계좌 상태 조회

### Execution Layer
- `prepare_next_open_plan.py`
- `execute_next_open_plan.py`
- `run_virtual_live.py`
- `run_virtual_next_open_forever.py`

### Visualization
- Streamlit 실시간 대시보드
- 현금 / 보유 / 총자산 분리 표시
- Plan / 로그 / 상태 시각화

### Notification
- Telegram 알림 (비필수)
- 네트워크 오류 발생 시에도 매매 로직 비중단

---

## 📖 프로젝트 개요

KHMS-TRADER는 한국 주식시장 자동매매를  
단순히 “수익률”이 아닌  
**운영 안정성 · 재현성 · 디버깅 가능성** 관점에서 접근한  
연구 및 실전 운용 겸용 트레이딩 시스템입니다.

전략 아이디어 검증 → 시뮬레이션 → 모의계좌 운영 → 실계좌 확장을  
**하나의 코드베이스**에서 안전하게 수행할 수 있도록 설계되었습니다.

모든 매매는 반드시 다음의 2단계 구조를 따릅니다.

1. **계획(Plan) 생성**
2. **계획 기반 실행(Execute)**

이를 통해 첫 실행 시에도 사고 주문이 발생하지 않도록 방어합니다.

---

## ⚙️ 운영 방식

### 수동 운영 (권장)

**1. 매일 장 마감 전 (15:40)**  
- 다음 거래일 Plan 생성

**2. 다음날 장 시작 직후 (09:01)**  
- Plan 기반 실제 주문 실행

---

### 자동 운영

- 상시 스케줄러 실행
- 지정 시각에 Plan 생성 및 주문 자동 수행

---

## 📊 대시보드

- KIS 모의계좌 기준 실시간 상태 조회
- 현금 / 보유 / 총자산 명확 분리
- 최신 Plan 및 실행 로그 확인
- 실험(PaperBroker)과 운영 계좌 완전 분리

Streamlit 기반으로 제공되며,  
조회 전용으로 설계되어 매매 로직에 영향을 주지 않습니다.

---

## 🧠 설계 원칙 (중요)

- **Sell 신호 ≠ 실제 매도**
- 보유하지 않은 종목은 절대 매도하지 않음
- 실험 상태와 운영 계좌 상태 철저히 분리
- 관리자용 스크립트는 일반 운영 경로에서 분리
- 오류 발생 시에도 계좌 보호 우선

---

## 🚧 현재 상태

- ✅ KIS Virtual 연동 완료  
- ✅ Next-Open 파이프라인 안정화  
- ✅ 대시보드 및 상태 조회 정상  
- ✅ 초기 계좌 정리 및 운영 환경 확정  
- ✅ 수동 / 자동 운영 루트 분리 완료  

---

## 🔮 향후 확장 계획

- 실계좌(Real) 전환
- 전략 다중화
- Ledger 기반 포지션 관리
- 성과 분석 리포트 자동화
- AI 기반 신호 생성 모듈 결합

---

> **본 프로젝트는**  
> “한 번 더 수익을 내기보다,  
> 한 번의 사고를 막는 자동매매”를 목표로 합니다.
